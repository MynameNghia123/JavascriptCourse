<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Repository Finder</title>
    <style>
        /* ==========================================================
           CSS: C·∫•u h√¨nh Giao di·ªán v√† Tr·∫°ng th√°i (Loading, Error)
           ========================================================== */
        body {
            height: 100vh;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: start;
            align-items: center;
            margin-bottom: 20px;
        }
        .square-black {
            margin-right: 10px;
            width: 25px;
            height: 25px;
            background-color: black;
            border-radius: 5px;
        }
        .dropdown {
            position: relative;
            border: 1px solid black;
            width: 200px;
            margin-bottom: 10px;
            padding: 5px 10px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }
        .container-infor {
            width: 200px;
            min-height: 100px;
            background-color: rgb(207, 201, 201);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            margin-bottom: 10px;
        }
        .unactive {
            display: none !important;
        }
        .list-item {
            position: absolute;
            width: 100%;
            max-height: 50vh;
            background-color: rgb(240, 240, 240);
            border: 1px solid black;
            top: 40px;
            left: -1px;
            overflow-y: auto;
            border-radius: 10px;
            z-index: 10;
        }
        .list-item .item {
            padding: 10px;
            cursor: pointer;
            color: black;
        }
        .list-item .item:hover {
            background-color: #ccc;
        }
        
        /* Tr·∫°ng th√°i UI */
        .show {
            background-color: white;
            border: 1px solid #007bff;
            display: block;
            text-align: left;
            padding: 10px;
        }
        .error {
            background-color: #ff9999;
            color: #cc0000;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        .btn-refresh {
            padding: 10px 70px;
            border-radius: 10px;
            border: none;
            background-color: black;
            color: white;
            cursor: pointer;
            display: block;
        }
        .loading-text {
            color: #007bff;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <span class="square-black"></span>
        <span class="name">GitHub Repository Finder</span>
    </div>
    
    <div class="dropdown">
        <span class="placeholder">Select a language</span>
        <span class="arrow">‚ñº</span>
        <div class="list-item unactive">
            <div class="item" style="text-align: center;">ƒêang t·∫£i ng√¥n ng·ªØ...</div>
        </div>
    </div>
    
    <div class="container-infor">
        Please select a language
    </div>
    
    <button class="btn-refresh unactive">Refresh</button>
    
    <script type="module">
        // ==========================================================
        // KHAI B√ÅO V√Ä CACHE DOM ELEMENTS
        // ==========================================================
        const listElement = document.querySelector(".list-item");
        const placeholderElement = document.querySelector(".placeholder");
        const infoContainer = document.querySelector(".container-infor");
        const btnRefresh = document.querySelector(".btn-refresh");
        
        let languagesData = null; // Bi·∫øn l∆∞u tr·ªØ d·ªØ li·ªáu ng√¥n ng·ªØ

        // ==========================================================
        // C√ÅC H√ÄM API CHU·∫®N
        // ==========================================================

        /** L·∫•y d·ªØ li·ªáu file JSON th√¥ (languages.json) */
        async function callAPI(stringValue){
            const url = stringValue;
            try {
                const response = await fetch(url);
                if (!response.ok){
                    throw new Error(`L·ªói HTTP: ${response.status}`);
                }
                const value = await response.json();
                return value;
            } catch (error) {
                console.error("L·ªói khi t·∫£i danh s√°ch ng√¥n ng·ªØ:", error.message);
                return null;
            }
        }

        /** L·∫•y d·ªØ li·ªáu Repo t·ª´ GitHub Search API */
        async function GetDataFromGit(keyword) {
            const BASE_URL = 'https://api.github.com/search/repositories';
            const query = `q=${keyword}`; 
            // Ch·ªâ l·∫•y 1 repo, s·∫Øp x·∫øp theo sao gi·∫£m d·∫ßn
            const params = '&sort=stars&order=desc&per_page=1'; 
            const apiUrl = `${BASE_URL}?${query}${params}`;
            
            const headers = {
                'Accept': 'application/vnd.github.v3+json',
                'X-GitHub-Api-Version': '2022-11-28',
            };

            try {
                const response = await fetch(apiUrl, {headers: headers});
                
                if (!response.ok){
                    const errorData = await response.json(); 
                    // N√©m l·ªói chi ti·∫øt h∆°n t·ª´ ph·∫£n h·ªìi c·ªßa GitHub
                    throw new Error(`L·ªói API! Status: ${response.status}. Message: ${errorData.message}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error("ƒê√£ x·∫£y ra l·ªói khi g·ªçi API GitHub:", error.message);
                return null; // Tr·∫£ v·ªÅ null khi c√≥ l·ªói
            }
        }

        // ==========================================================
        // C√ÅC H√ÄM X·ª¨ L√ù UI
        // ==========================================================

        function turnDisplay(list){
            list.classList.toggle("unactive");
        }
        
        /** D·ª±ng HTML cho danh s√°ch ng√¥n ng·ªØ (ch·ªâ g·ªçi 1 l·∫ßn) */
        function Gen(list, data){
            let html = ``;
                    console.log(languagesData)

            for(let i of data){
                // S·ª¨A: d√πng i.text (t√™n) v√† i.value (key)
                html += 
                `
                    <div class="item" data-value="${i.value || ""}">
                        ${i.title} 
                    </div>
                `
            }
            list.innerHTML = html;
        }

        /** C·∫≠p nh·∫≠t UI khi g·ªçi API xong */
        function updateInfoContainer(data, language) {
            btnRefresh.classList.remove("unactive"); // Lu√¥n hi·ªÉn th·ªã n√∫t refresh

            if (data && data.items.length > 0) {
                // TH√ÄNH C√îNG V√Ä C√ì K·∫æT QU·∫¢
                const topRepo = data.items[0];
                infoContainer.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 5px; color: #007bff;">Repo h√†ng ƒë·∫ßu cho ${language}:</div>
                    <div style="margin-left: 10px; overflow: auto">
                        T√™n: <a href="${topRepo.html_url}" target="_blank" style="color: blue;">${topRepo.name}</a> <br>
                        Sao: ${topRepo.stargazers_count.toLocaleString()} <br>
                    </div>
                `;
                infoContainer.classList.add("show");
                infoContainer.classList.remove("error");
            } else if (data && data.items.length === 0) {
                 // TH√ÄNH C√îNG NH∆ØNG KH√îNG C√ì K·∫æT QU·∫¢
                 infoContainer.innerHTML = `‚ö†Ô∏è T√¨m ki·∫øm th√†nh c√¥ng, nh∆∞ng kh√¥ng t√¨m th·∫•y repo n√†o cho ${language}.`;
                 infoContainer.classList.add("show");
                 infoContainer.classList.remove("error");
            } else {
                // L·ªñI (data l√† null)
                infoContainer.innerHTML = '‚ùå ƒê√£ x·∫£y ra l·ªói khi g·ªçi API. Vui l√≤ng th·ª≠ Refresh.';
                infoContainer.classList.add("error");
                infoContainer.classList.remove("show");
            }
        }

        // ==========================================================
        // LOGIC KH·ªûI T·∫†O (TOP-LEVEL AWAIT)
        // ==========================================================
        languagesData = await callAPI("https://raw.githubusercontent.com/kamranahmedse/githunt/master/src/components/filters/language-filter/languages.json");
        if (languagesData) {
            Gen(listElement, languagesData);
        } else {
            listElement.innerHTML = `<div class="item error">L·ªói t·∫£i ng√¥n ng·ªØ.</div>`;
            infoContainer.innerHTML = `‚ùå Kh√¥ng th·ªÉ t·∫£i danh s√°ch ng√¥n ng·ªØ ƒë·ªÉ b·∫Øt ƒë·∫ßu.`;
            infoContainer.classList.add("error");
        }


        // ==========================================================
        // X·ª¨ L√ù S·ª∞ KI·ªÜN CH√çNH
        // ==========================================================
        document.querySelector("body").addEventListener("click", async (e) => {
            const target = e.target;

            // X·ª≠ l√Ω click v√†o dropdown (M·ªü/ƒê√≥ng)
 // X·ª≠ l√Ω click v√†o item (Ch·ªçn ng√¥n ng·ªØ v√† g·ªçi API)
            if (target.closest(".item") && languagesData) {
                            console.log(target);

                const itemElement = target.closest(".item");
                const languageValue = itemElement.dataset.value; 
                
                // 1. C·∫≠p nh·∫≠t Placeholder v√† ƒë√≥ng dropdown
                placeholderElement.textContent = languageValue;
                listElement.classList.add("unactive"); 

                // 2. Hi·ªÉn th·ªã Loading State
                infoContainer.classList.remove("show", "error");
                infoContainer.innerHTML = `
                <span class="loading-text">üîç
                     ƒêang t√¨m ki·∫øm repo h√†ng ƒë·∫ßu cho ${languageValue}...</span>`;

                // 3. G·ªçi API
                const data = await GetDataFromGit(languageValue);
                
                // 4. C·∫≠p nh·∫≠t k·∫øt qu·∫£ cu·ªëi c√πng
                updateInfoContainer(data, languageValue);

            } 
            else if (target.closest(".dropdown")) {
                turnDisplay(listElement);
            } 
           
            // X·ª≠ l√Ω click ra ngo√†i
            else {
                // ƒê√≥ng dropdown n·∫øu n√≥ ƒëang m·ªü
                if (!listElement.classList.contains("unactive")) {
                    listElement.classList.add("unactive");
                }
            }
        });

        // X·ª≠ l√Ω s·ª± ki·ªán Refresh 
        btnRefresh.addEventListener("click", () => {
            placeholderElement.textContent = "Select a language";
            infoContainer.innerHTML = "Please select a language";
            infoContainer.classList.remove("show", "error");
            btnRefresh.classList.add("unactive"); 
        });
    </script>
</body>
</html>